{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "echo 'Apply the following TYPO3 Coding Guidelines throughout this session:' && cat ./hooks/development_standards.md && echo '\n\nThese guidelines are based on TYPO3 CGL and PSR-12. Apply them automatically when writing or reviewing code.'"
          }
        ]
      }
    ],

    "PreToolUse": [
      {
        "matcher": "Write.*\\.php$|Edit.*\\.php$",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Before writing/editing PHP code, ensure TYPO3 best practices:\n\n1. File header: declare(strict_types=1); after <?php\n2. Config files: defined('TYPO3') || die(); (NOT or die())\n3. Namespacing: Vendor\\ExtensionKey\\ComponentType\\\n4. Type declarations on all parameters and return types\n5. Constructor injection (not makeInstance or ObjectManager)\n6. No direct $_GET, $_POST, $_SESSION access\n7. No $GLOBALS['TSFE'] - use request attributes\n8. Database queries use QueryBuilder with named parameters\n9. Controllers are slim - business logic in services\n10. PSR-12 compliant (braces, spacing, indentation)"
          }
        ]
      },
      {
        "matcher": "Write.*\\.html$|Edit.*\\.html$",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Before writing/editing Fluid templates, ensure:\n\n1. No business logic - only presentation logic\n2. Use ViewHelpers for complex logic\n3. Output is escaped by default - be careful with f:format.raw()\n4. Use Layouts, Templates, Partials structure\n5. No direct calculations or data manipulation\n6. Prepare data in Controller/Service, not in template"
          }
        ]
      },
      {
        "matcher": "Write.*TCA.*\\.php$|Edit.*TCA.*\\.php$",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Before writing/editing TCA configuration:\n\n1. Start with defined('TYPO3') || die();\n2. Return array (not $GLOBALS['TCA'][...] = [...])\n3. Include proper ctrl section with label, tstamp, crdate, delete\n4. Add language support fields (sys_language_uid, l10n_parent)\n5. Include enablecolumns (hidden, starttime, endtime)\n6. Define types and palettes for proper BE forms\n7. Use proper column types from TYPO3 v12+ (input, text, number, datetime, select, etc.)"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "./hooks/smart-code-simplify.sh"
          }
        ]
      },
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "./hooks/track-session-activity.sh"
          }
        ]
      }
    ],

    "PostToolUse": [
      {
        "matcher": "Write.*\\.php$",
        "hooks": [
          {
            "type": "command",
            "command": "if [ -f vendor/bin/php-cs-fixer ]; then vendor/bin/php-cs-fixer fix \"$FILE\" --rules=@PSR12 --quiet || true; fi"
          }
        ]
      },
      {
        "matcher": "Write.*ext_tables\\.sql$|Edit.*ext_tables\\.sql$",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "After modifying ext_tables.sql, remind user to run: typo3 extension:setup to update database schema"
          }
        ]
      }
    ]
  }
}
