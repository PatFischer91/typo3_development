{
  "hooks": {
    "SessionStart": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Apply the following TYPO3 Coding Guidelines throughout this session:\n\n## PHP/TYPO3 Development Standards\n\n### Code Style (PSR-12)\n- 4 spaces indentation (no tabs)\n- Opening braces on new line for classes/methods\n- Max 120 chars per line\n- Use single quotes for strings\n- Always use `declare(strict_types=1);` after `<?php`\n- Config files: `defined('TYPO3') || die();` (NOT `or die()`!)\n\n### Namespacing\n- Format: `Vendor\\ExtensionKey\\ComponentType\\`\n- Vendor name in StudlyCase\n- Extension key in StudlyCase (even with underscores)\n\n### Dependency Injection\n- ALWAYS use constructor injection with `private readonly`\n- NEVER use ObjectManager (removed in v12)\n- NEVER use GeneralUtility::makeInstance() for services\n- Services auto-wired via Services.yaml\n\n### Database Queries\n- ALWAYS use Doctrine DBAL QueryBuilder\n- ALWAYS use createNamedParameter() with PDO types\n- NEVER use $GLOBALS['TYPO3_DB'] (removed in v10)\n- NEVER concatenate user input into SQL\n\n### Controllers\n- Keep controllers SLIM - move business logic to services\n- All actions MUST return ResponseInterface\n- NEVER use $GLOBALS['TSFE'] - use request attributes\n- NEVER access $_GET, $_POST, $_SESSION directly\n- Use $this->request instead\n\n### Fluid Templates\n- NO business logic in templates - only presentation\n- Use ViewHelpers for complex presentation logic\n- NEVER use f:format.raw() on user input (XSS!)\n- Prepare data in Controller/Service, not template\n\n### HTTP Requests\n- Use RequestFactory instead of GeneralUtility::getUrl()\n- Use RequestFactory instead of raw cURL\n\n### Events\n- Use PSR-14 Events instead of old hook system\n- Register listeners in Services.yaml\n\n### TCA Configuration\n- Start with `defined('TYPO3') || die();`\n- Return array (not $GLOBALS['TCA'][...] = [...])\n- Include ctrl section with label, tstamp, crdate, delete\n- Add language support fields (sys_language_uid, l10n_parent)\n- Include enablecolumns (hidden, starttime, endtime)\n\n### Security\n- Validate all user input\n- QueryBuilder with named parameters (never concatenate SQL)\n- Fluid escapes by default - be careful with f:format.raw()\n- Validate file uploads (type, size, content)\n- Never log passwords or tokens\n\n### Directory Structure\n- PHP logic belongs in Classes/Domain/ (or subdirectories)\n- Business logic in Services, not Controllers\n- Data access only in Repositories\n\nThese guidelines are based on TYPO3 CGL and PSR-12. Apply them automatically when writing or reviewing code."
          }
        ]
      }
    ],

    "PreToolUse": [
      {
        "matcher": "Write.*\\.php$|Edit.*\\.php$",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Before writing/editing PHP code, ensure TYPO3 best practices:\n\n1. File header: declare(strict_types=1); after <?php\n2. Config files: defined('TYPO3') || die(); (NOT or die())\n3. Namespacing: Vendor\\ExtensionKey\\ComponentType\\\n4. Type declarations on all parameters and return types\n5. Constructor injection (not makeInstance or ObjectManager)\n6. No direct $_GET, $_POST, $_SESSION access\n7. No $GLOBALS['TSFE'] - use request attributes\n8. Database queries use QueryBuilder with named parameters\n9. Controllers are slim - business logic in services\n10. PSR-12 compliant (braces, spacing, indentation)"
          }
        ]
      },
      {
        "matcher": "Write.*\\.html$|Edit.*\\.html$",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Before writing/editing Fluid templates, ensure:\n\n1. No business logic - only presentation logic\n2. Use ViewHelpers for complex logic\n3. Output is escaped by default - be careful with f:format.raw()\n4. Use Layouts, Templates, Partials structure\n5. No direct calculations or data manipulation\n6. Prepare data in Controller/Service, not in template"
          }
        ]
      },
      {
        "matcher": "Write.*TCA.*\\.php$|Edit.*TCA.*\\.php$",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Before writing/editing TCA configuration:\n\n1. Start with defined('TYPO3') || die();\n2. Return array (not $GLOBALS['TCA'][...] = [...])\n3. Include proper ctrl section with label, tstamp, crdate, delete\n4. Add language support fields (sys_language_uid, l10n_parent)\n5. Include enablecolumns (hidden, starttime, endtime)\n6. Define types and palettes for proper BE forms\n7. Use proper column types from TYPO3 v12+ (input, text, number, datetime, select, etc.)"
          }
        ]
      }
    ],

    "PostToolUse": [
      {
        "matcher": "Write.*\\.php$",
        "hooks": [
          {
            "type": "command",
            "command": "if [ -f vendor/bin/php-cs-fixer ]; then vendor/bin/php-cs-fixer fix \"$FILE\" --rules=@PSR12 --quiet || true; fi"
          }
        ]
      },
      {
        "matcher": "Write.*ext_tables\\.sql$|Edit.*ext_tables\\.sql$",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "After modifying ext_tables.sql, remind user to run: typo3 extension:setup to update database schema"
          }
        ]
      }
    ]
  }
}
